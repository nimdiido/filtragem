<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listagem de Parafusos</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
</head>

<body>
    <div class="container">
        <h1>Listagem de Parafusos</h1>

        <!-- Filtros -->
        <div class="filters">
            <div class="filter-row">
                <label for="nome-filter">Nome:</label>
                <input type="text" id="nome-filter" autocomplete="off" placeholder="Filtrar por nome">
            </div>

            <div class="filter-row">
                <label for="modelo-filter">Modelo:</label>
                <select id="modelo-filter">
                    <option value="">Não especificado</option>
                </select>

                <label for="rosca-filter">Rosca:</label>
                <select id="rosca-filter">
                    <option value="">Não especificado</option>
                </select>
            </div>

            <div class="filter-row">
                <label for="bitola-filter">Bitola:</label>
                <select id="bitola-filter">
                    <option value="">Não especificado</option>
                </select>

                <label for="comprimento-filter">Comprimento:</label>
                <select id="comprimento-filter">
                    <option value="">Não especificado</option>
                </select>
            </div>


            <div class="filter-row">
                <label for="haste-filter">RI / RP:</label>
                <select id="haste-filter">
                    <option value="">Não especificado</option>
                </select>

                <label for="acabamento-filter">Acabamento:</label>
                <select id="acabamento-filter">
                    <option value="">Não especificado</option>
                </select>
            </div>

            <div class="filter-row">
                <label for="material-filter">Material:</label>
                <select id="material-filter">
                    <option value="">Não especificado</option>
                </select>

                <label for="classe-filter">Classe:</label>
                <select id="classe-filter">
                    <option value="">Não especificado</option>
                </select>
            </div>
        </div>

        <button id="filtrar-btn">Filtrar</button>

        <!-- Lista de Parafusos -->
        <ul id="parafusos-list">
            <!-- Os itens serão adicionados aqui -->
        </ul>

        <!-- Botão de Mostrar Mais -->
        <button id="mostrar-mais-btn" style="display: none;">Mostrar mais</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const nomeFilter = document.getElementById('nome-filter');
            const comprimentoFilter = document.getElementById('comprimento-filter');
            const bitolaFilter = document.getElementById('bitola-filter');
            const acabamentoFilter = document.getElementById('acabamento-filter');
            const modeloFilter = document.getElementById('modelo-filter');
            const roscaFilter = document.getElementById('rosca-filter');
            const hasteFilter = document.getElementById('haste-filter');
            const materialFilter = document.getElementById('material-filter');
            const classeFilter = document.getElementById('classe-filter');

            const ipAddress = location.hostname;

            function carregarOpcoes(url, dropdown, ordenar = null) {
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (ordenar) {
                            data.sort(ordenar);
                        } else {
                            data.sort();
                        }

                        dropdown.innerHTML = '<option value="">Não especificado</option>';

                        data.forEach(opcao => {
                            const option = document.createElement('option');
                            option.textContent = opcao;
                            option.value = opcao;
                            dropdown.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error(`Erro ao buscar opções de ${dropdown.id}:`, error);
                    });
            }

            function ordenarComprimentos(a, b) {
                const ordem = [
                    '2.1/2"', '3/4"', '1"', '1.1/2"', '2"', '3"', '4"', '5"', '6"', '7"',
                    '10mm', '20mm', '30mm', '40mm', '50mm', '60mm', '70mm'
                ];
                return ordem.indexOf(a) - ordem.indexOf(b);
            }

            function ordenarBitolas(a, b) {
                const ordemBitolas = [
                    '1/8"', '3/16"', '1/4"', '5/16"', '3/8"', '7/16"', '1/2"', '9/16"', '5/8"', '3/4"', '7/8"', '1"', '1.1/4"', '1.1/2"', '2"', '2.1/2"', '3"', '4"', '5"', '6"',
                    '3mm', '4mm', '5mm', '6mm', '8mm', '10mm', '12mm', '16mm', '20mm', '24mm', '30mm', '36mm', '40mm', '50mm', '60mm', '70mm'
                ];
                return ordemBitolas.indexOf(a) - ordemBitolas.indexOf(b);
            }

            carregarOpcoes(`http://${ipAddress}:3000/api/comprimentos`, comprimentoFilter, ordenarComprimentos);
            carregarOpcoes(`http://${ipAddress}:3000/api/bitolas`, bitolaFilter, ordenarBitolas);
            carregarOpcoes(`http://${ipAddress}:3000/api/acabamentos`, acabamentoFilter);
            carregarOpcoes(`http://${ipAddress}:3000/api/modelos`, modeloFilter);
            carregarOpcoes(`http://${ipAddress}:3000/api/roscas`, roscaFilter);
            carregarOpcoes(`http://${ipAddress}:3000/api/hastes`, hasteFilter);
            carregarOpcoes(`http://${ipAddress}:3000/api/materiais`, materialFilter);
            carregarOpcoes(`http://${ipAddress}:3000/api/classes`, classeFilter);

            let currentPage = 1;

            const filtrarBtn = document.getElementById('filtrar-btn');
            const mostrarMaisBtn = document.getElementById('mostrar-mais-btn');

            function buscarParafusos(page = 1) {
                const filtro = {
                    nome: nomeFilter.value,
                    comprimento: comprimentoFilter.value,
                    bitola: bitolaFilter.value,
                    acabamento: acabamentoFilter.value,
                    modelo: modeloFilter.value,
                    rosca: roscaFilter.value,
                    haste: hasteFilter.value,
                    material: materialFilter.value,
                    classe: classeFilter.value,
                    page,
                    limit: 5
                };

                let url = `http://${ipAddress}:3000/api/parafusos?`;
                Object.keys(filtro).forEach(key => {
                    if (filtro[key]) {
                        url += `${key}=${filtro[key]}&`;
                    }
                });

                fetch(url)
                    .then(response => response.json())
                    .then(parafusos => {
                        const parafusosList = document.getElementById('parafusos-list');

                        if (page === 1) {
                            parafusosList.innerHTML = '';
                        }

                        parafusos.forEach(parafuso => {
                            const listItem = document.createElement('li');
                            listItem.textContent = `${parafuso.referencia} — ${parafuso.nome}`;
                            parafusosList.appendChild(listItem);
                        });

                        if (parafusos.length < 5) {
                            mostrarMaisBtn.style.display = 'none';
                        } else {
                            mostrarMaisBtn.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao buscar parafusos:', error);
                    });
            }

            filtrarBtn.addEventListener('click', () => {
                currentPage = 1;
                buscarParafusos(currentPage);
            });

            mostrarMaisBtn.addEventListener('click', () => {
                currentPage++;
                buscarParafusos(currentPage);
            });
        });
    </script>
</body>

</html>